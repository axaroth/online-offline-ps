# Updates the dumper properties
import logging
logger = logging.getLogger('OOPS Demo')

def update(portal, configurations, name='default'):
    dumper = portal.portal_dumper
    if name not in dumper.objectIds():
        dumper.manage_addPropertySheet(name)
    props = dumper[name]
    for key,value in configurations.items():
        props._setProperty(key, value)

## OOPS Demo
base_theme = '/oops/demo/dumptheme/skins/'
base_dump_theme_folder = '${omelette:location}' + base_theme
base_dump_extra_folder = '${dump-extra-resources:location}'

configurations = {}
configurations['title'] = 'OOPS Demo'
configurations['html_base'] = '${dumper-config:html_base}/demo'
configurations['filesystem_target'] = '${dumper-config:filesystem_target}/demo'

configurations['theme_folders'] = [
    base_dump_theme_folder + 'oops_demo_dumptheme_static',
    base_dump_extra_folder + '/oops-gears'
]

configurations['theme'] = '${dumper-config:theme}'
configurations['dump_configuration_name'] = '${dumper-config:dump_configuration_name}'

#XXX we need to create a new version of oops.searchdumpers for multidumper or
# refactor the product
#    configurations['search_db_path'] = '${dumper-config:search_db_path}'
logger.warning('OOPS SEARCH: search_db_path property non configured!')

update(portal, configurations)


## OOPS mobile
base_theme = '/oops/demo/mobiletheme/skins/'
base_dump_theme_folder = '${omelette:location}' + base_theme
base_dump_extra_folder = '${dump-extra-resources:location}'

configurations = {}
configurations['title'] = 'OOPS Demo Mobile'
configurations['html_base'] = '${dumper-config:html_base}/mobile'
configurations['filesystem_target'] = '${dumper-config:filesystem_target}/mobile'

configurations['theme_folders'] = [
    base_dump_theme_folder + 'oops_demo_mobiletheme_static',
    base_dump_extra_folder + '/oops-gears'
]

configurations['theme'] = 'OOPS Demo Mobile Theme'
configurations['html5'] = True  # activate manifest
configurations['pdf'] = False   # disable pdf generation
configurations['dump_configuration_name'] = '${dumper-config:dump_configuration_name}'

update(portal, configurations, 'mobile')
